<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TITAN HOLO</title>
  <style>
    html, body {
      margin: 0; padding: 0; overflow: hidden; width: 100%; height: 100%;
      background-color: #3E363F;
      font-family: Arial, sans-serif;
      color: #fffce8;
      text-align: center;
      user-select: none;
      position: relative;
    }

    #mainImage {
      width: 58%;
      border: 10px solid #fffce8;
      border-radius: 20px;
      margin: 160px auto 0 auto;
      position: relative;
      z-index: 3;
      pointer-events: none;
      display: block;
      box-shadow: 0 0 20px rgba(255, 252, 232, 0.3);
      animation: borderGlow 3s ease-in-out infinite;
    }

    @keyframes borderGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 252, 232, 0.3); }
      50% { box-shadow: 0 0 40px rgba(255, 252, 232, 0.6); }
    }

    #neverForget, #pressF, #secretHint {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      color: #fffce8;
      text-align: center;
      z-index: 3;
      pointer-events: auto;
      user-select: text;
    }

    #neverForget {
      top: 15px;
      font-size: 3.5em;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      color: #fffce8;
    }
    #neverForget span:first-child { color: #DD403A; }
    #neverForget span:nth-child(3) { color: #DD403A; }

    #neverForget img {
      width: 64px;
      height: 64px;
      vertical-align: middle;
      margin-left: 10px;
    }

    #pressF {
      top: 95px;
      font-size: 1.5em;
      cursor: pointer;
      color: #fffce8;
    }
    #pressF strong {
      color: #DD403A;
    }

    #secretHint {
      top: 125px;
      font-size: 1.1em;
      color: #7EC8E3;
      font-style: italic;
    }

    a {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #fffce8;
      text-decoration: none;
      font-size: 1.2em;
      z-index: 5;
      user-select: text;
      transition: all 0.3s ease;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.7);
    }
    a strong {
      color: #7EC8E3;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    a:hover {
      transform: translateX(-50%) translateY(-3px);
    }
    a:hover strong {
      color: #DD403A;
      text-shadow: 0 0 10px rgba(221, 64, 58, 0.5);
    }

    canvas {
      position: fixed;
      top: 0;
      left: 0;
      pointer-events: auto;
      width: 100%;
      height: 100%;
      z-index: 4;
      display: block;
      background: transparent;
    }

    .top-button {
      position: fixed;
      top: 20px;
      left: 20px;
      background: #DD403A;
      color: #fffce8;
      border: 2px solid #fffce8;
      border-radius: 10px;
      padding: 10px 20px;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      z-index: 6;
      transition: all 0.3s ease;
      font-family: Arial, sans-serif;
    }

    .top-button:hover {
      background: #fffce8;
      color: #DD403A;
      transform: scale(1.05);
    }

    #addStickerBtn {
      top: 70px;
    }

    .plus-one {
      position: fixed;
      color: #4ade80;
      font-size: 2em;
      font-weight: bold;
      pointer-events: none;
      z-index: 10;
      text-shadow: 0 0 10px rgba(74, 222, 128, 0.8);
      animation: floatUp 1.5s ease-out forwards;
    }

    @keyframes floatUp {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-120px) scale(1.2);
      }
    }

    .sparkle {
      position: fixed;
      pointer-events: none;
      z-index: 9;
      animation: sparkleAnim 0.6s ease-out forwards;
    }

    @keyframes sparkleAnim {
      0% {
        opacity: 1;
        transform: translate(0, 0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(var(--tx), var(--ty)) scale(0);
      }
    }
  </style>
</head>
<body>

  <img id="mainImage" src="titan-holo.png" alt="TITAN HOLO" />

  <div id="neverForget" aria-live="polite">
    <span>#</span>Never<span>Forget</span> <img src="clueless-aware.gif" alt="AWARE" />
  </div>

  <div id="pressF" role="button" tabindex="0">
    Press <strong>F</strong> to pay respects (<span id="fCount">0</span>)
  </div>
  <div id="secretHint" style="display: none;"></div>

  <button class="top-button" id="resetBtn">Reset Stickers</button>
  <button class="top-button" id="addStickerBtn">+1 Sticker</button>

  <a href="https://guns.lol/chris_got" aria-label="Made by Chris Got link">Made by <strong>Chris Got</strong> →</a>

  <canvas id="physicsCanvas"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
  <script>
    const { Engine, Render, Runner, World, Bodies, Body, Events, Mouse, MouseConstraint } = Matter;

    const canvas = document.getElementById("physicsCanvas");
    const engine = Engine.create();
    const world = engine.world;

    const render = Render.create({
      canvas: canvas,
      engine: engine,
      options: {
        width: window.innerWidth,
        height: window.innerHeight,
        wireframes: false,
        background: "transparent"
      }
    });

    const imageFiles = [
      "360fx360f1.png", "360fx360f2.png", "360fx360f3.png", "360fx360f8.png",
      "360fx360f4.png", "360fx360f5.png", "360fx360f6.png", "360fx360f.png",
      "360fx360f.png", "360fx360f01.png", "360fx360f7.png", "360fx360f.png", "360fx360f9.png"
    ];

    const specialIndex = 3;
    const specialNewImage = "360fx360f.png";
    const specialSound = "Quick Fart.mp3";
    const largeIndex = 8;

    const NUM_BALLS = 13;
    const RESTITUTION = 0.85;
    const FRICTION_AIR = 0.02;

    const balls = [];
    const sound = new Audio(specialSound);
    const vineBoom = new Audio("Vine Boom.mp3");
    const cw = window.innerWidth;
    const ch = window.innerHeight;
    engine.gravity.y = 1;

    let walls = [
      Bodies.rectangle(cw / 2, ch + 50, cw, 100, { isStatic: true }),
      Bodies.rectangle(-50, ch / 2, 100, ch, { isStatic: true }),
      Bodies.rectangle(cw + 50, ch / 2, 100, ch, { isStatic: true })
    ];
    World.add(world, walls);

    let respectCount = 0;
    let mac10Spawned = false;

    function loadImage(src) {
      return new Promise(res => {
        const img = new Image();
        img.onload = () => res(img);
        img.onerror = () => {
          console.warn("Failed to load image:", src);
          res(null);
        };
        img.src = src;
      });
    }

    async function createBall(i, customRadius = null, customImage = null, makeSpecial = false) {
      const imgSrc = customImage || imageFiles[i] || "";
      const radius = customRadius || (i === largeIndex ? 80 : 60);

      const startX = Math.random() * (cw - 2 * radius) + radius;
      const startY = Math.random() * (ch / 2) + radius;

      let ballOptions = {
        restitution: RESTITUTION,
        frictionAir: FRICTION_AIR,
        render: { 
          fillStyle: "#fffce8",
          strokeStyle: "#DD403A",
          lineWidth: 2
        }
      };

      if (imgSrc) {
        const img = await loadImage(imgSrc);
        if (img) {
          let scale;
          if (customImage === "Mac10Heat.png") {
            scale = (radius * 2) / 501;
          } else {
            scale = ((radius * 2) / 360) * 1.8;
          }
          ballOptions.render.sprite = {
            texture: imgSrc,
            xScale: scale,
            yScale: scale
          };
        }
      }

      const ball = Bodies.circle(startX, startY, radius, ballOptions);
      ball.isSpecial = makeSpecial || i === specialIndex;
      ball.originalTexture = imgSrc;
      ball.trailPoints = [];

      World.add(world, ball);
      balls.push(ball);

      return ball;
    }

    async function initBalls() {
      for (let i = 0; i < NUM_BALLS; i++) {
        await createBall(i);
      }
    }

    function createSparkles(x, y) {
      const colors = ['#FFD700', '#FFA500', '#FF69B4', '#00CED1', '#7EC8E3'];
      for (let i = 0; i < 8; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.textContent = '✨';
        sparkle.style.left = x + 'px';
        sparkle.style.top = y + 'px';
        sparkle.style.color = colors[Math.floor(Math.random() * colors.length)];
        sparkle.style.fontSize = (Math.random() * 20 + 15) + 'px';
        
        const tx = (Math.random() - 0.5) * 150;
        const ty = (Math.random() - 0.5) * 150;
        sparkle.style.setProperty('--tx', tx + 'px');
        sparkle.style.setProperty('--ty', ty + 'px');
        
        document.body.appendChild(sparkle);
        setTimeout(() => sparkle.remove(), 600);
      }
    }

    function showPlusOne(x, y) {
      const plusOne = document.createElement('div');
      plusOne.className = 'plus-one';
      plusOne.textContent = '+1';
      plusOne.style.left = x + 'px';
      plusOne.style.top = y + 'px';
      document.body.appendChild(plusOne);
      setTimeout(() => plusOne.remove(), 1500);
    }

    function updateRespectText() {
      const hint = document.getElementById('secretHint');
      const fCount = document.getElementById('fCount');

      fCount.textContent = respectCount;

      if (respectCount >= 3 && respectCount < 67) {
        hint.textContent = "What is Mark's favourite number?";
        hint.style.display = 'block';
      } else if (respectCount === 67) {
        hint.innerHTML = '<strong>GG\'s</strong>';
        hint.style.display = 'block';
      } else if (respectCount >= 75) {
        hint.innerHTML = '<strong>You really wanna keep going?</strong>';
        hint.style.display = 'block';
      } else if (respectCount >= 100) {
        hint.innerHTML = '<strong>Damn you really wanted that holo huh...</strong>';
        hint.style.display = 'block';
      } else if (respectCount >= 120) {
        hint.innerHTML = '<strong>Alright dude it\'s enough</strong>';
        hint.style.display = 'block';
      } else if (respectCount >= 150) {
        hint.innerHTML = '<strong>There\'s nothing more to see here</strong>';
        hint.style.display = 'block';
      } else if (respectCount >= 200) {
        hint.innerHTML = '<strong>You\'ve seen everything. Please stop.</strong>';
        hint.style.display = 'block';
      } else if (respectCount >= 220) {
        hint.innerHTML = '<strong>I warned you</strong>';
        hint.style.display = 'block';
      } else if (respectCount >= 250) {
        hint.innerHTML = '<strong>Dumbass...</strong>';
        hint.style.display = 'block';
      } else {
        hint.style.display = 'none';
      }
    }

    async function updateRespect(clickX, clickY) {
      respectCount++;
      updateRespectText();
      
      createSparkles(clickX, clickY);
      showPlusOne(clickX, clickY);

      if (respectCount === 67 && !mac10Spawned) {
        mac10Spawned = true;
        vineBoom.play().catch(() => {});
        await createBall(0, 120, "Mac10Heat.png");
      }

      if (respectCount === 250) {
        setTimeout(() => {
          const newWindow = window.open('https://www.youtube.com/watch?v=dQw4w9WgXcQ', '_blank');
          if (!newWindow) {
            window.location.href = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
          }
        }, 1000);
      }
    }

    function drawTrails(context) {
      context.globalCompositeOperation = 'destination-over';
      
      for (const ball of balls) {
        const speed = Math.sqrt(ball.velocity.x ** 2 + ball.velocity.y ** 2);
        
        if (speed > 5) {
          ball.trailPoints.push({
            x: ball.position.x,
            y: ball.position.y,
            alpha: 1
          });
          
          if (ball.trailPoints.length > 15) {
            ball.trailPoints.shift();
          }
        } else {
          ball.trailPoints = [];
        }

        for (let i = 0; i < ball.trailPoints.length; i++) {
          const point = ball.trailPoints[i];
          const size = (i / ball.trailPoints.length) * ball.circleRadius * 0.8;
          point.alpha -= 0.05;

          if (point.alpha > 0) {
            const gradient = context.createRadialGradient(point.x, point.y, 0, point.x, point.y, size);
            gradient.addColorStop(0, `rgba(126, 200, 227, ${point.alpha * 0.6})`);
            gradient.addColorStop(0.5, `rgba(221, 64, 58, ${point.alpha * 0.4})`);
            gradient.addColorStop(1, `rgba(255, 215, 0, ${point.alpha * 0.2})`);

            context.beginPath();
            context.arc(point.x, point.y, size, 0, Math.PI * 2);
            context.fillStyle = gradient;
            context.fill();
          }
        }
      }
      
      context.globalCompositeOperation = 'source-over';
    }

    async function start() {
      await initBalls();

      const mouse = Mouse.create(render.canvas);
      const mouseConstraint = MouseConstraint.create(engine, {
        mouse: mouse,
        constraint: { stiffness: 0.2, render: { visible: false } }
      });
      World.add(world, mouseConstraint);

      Events.on(mouseConstraint, "startdrag", e => {
        const body = e.body;
        if (body && body.isSpecial) {
          if (specialSound) {
            sound.currentTime = 0;
            sound.play().catch(() => {});
          }
          if (specialNewImage) {
            loadImage(specialNewImage).then(img => {
              if (img && body.render.sprite) {
                const radius = body.circleRadius;
                const scale = ((radius * 2) / 360) * 1.8;
                body.render.sprite.texture = specialNewImage;
                body.render.sprite.xScale = scale;
                body.render.sprite.yScale = scale;
              }
            });
          }
        }
      });

      Events.on(render, 'afterRender', () => {
        drawTrails(render.context);
      });

      Render.run(render);
      const runner = Runner.create();
      Runner.run(runner, engine);

      for (const b of balls) {
        Body.setVelocity(b, { x: (Math.random() - 0.5) * 10, y: Math.random() * -10 });
      }

      const fCount = document.getElementById("fCount");
      fCount.textContent = respectCount;

      document.getElementById("pressF").addEventListener("click", (e) => {
        updateRespect(e.clientX, e.clientY);
      });

      document.addEventListener("keydown", e => {
        if (e.key.toLowerCase() === "f") {
          const rect = document.getElementById("pressF").getBoundingClientRect();
          updateRespect(rect.left + rect.width / 2, rect.top + rect.height / 2);
        }
      });

      document.getElementById("resetBtn").addEventListener("click", () => {
        // Remove all balls from the world
        for (const ball of balls) {
          World.remove(world, ball);
        }
        balls.length = 0;
        
        // Reset mac10 spawned flag but keep respect count
        const hadMac10 = respectCount >= 67;
        mac10Spawned = false;
        
        // Reinitialize balls
        initBalls().then(() => {
          // If we had reached 67 before, respawn the Mac10
          if (hadMac10) {
            mac10Spawned = true;
            createBall(0, 120, "Mac10Heat.png");
          }
          
          // Give all balls initial velocity
          for (const b of balls) {
            Body.setVelocity(b, { x: (Math.random() - 0.5) * 10, y: Math.random() * -10 });
          }
        });
      });

      document.getElementById("addStickerBtn").addEventListener("click", async () => {
        const rand = Math.random();
        let customRadius = null;
        let customImage = null;
        let makeSpecial = false;
        
        // 5% chance for special ball
        if (rand < 0.05) {
          customRadius = 60;
          customImage = imageFiles[specialIndex];
          makeSpecial = true;
        }
        // 15% chance for big ball
        else if (rand < 0.20) {
          customRadius = 80;
          // Filter out the special ball image
          const normalImages = imageFiles.filter((img, idx) => idx !== specialIndex);
          customImage = normalImages[Math.floor(Math.random() * normalImages.length)];
        }
        // 80% chance for regular ball
        else {
          customRadius = 60;
          // Filter out the special ball image
          const normalImages = imageFiles.filter((img, idx) => idx !== specialIndex);
          customImage = normalImages[Math.floor(Math.random() * normalImages.length)];
        }
        
        await createBall(balls.length, customRadius, customImage, makeSpecial);
        
        // Give the new ball some initial velocity
        const newBall = balls[balls.length - 1];
        Body.setVelocity(newBall, { x: (Math.random() - 0.5) * 10, y: Math.random() * -10 });
      });

      window.addEventListener("resize", () => {
        Render.lookAt(render, {
          min: { x: 0, y: 0 },
          max: { x: window.innerWidth, y: window.innerHeight }
        });
      });
    }

    start();
  </script>
</body>
</html>
